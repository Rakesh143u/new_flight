<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voyage Vista – Premium Travel Interface</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
                  
    </style>
  </head>
  <body>
    <div class="modal-backdrop" id="authModal">
  <div class="modal-window">
    <button class="modal-close" aria-label="Close">&times;</button>
    <h2>Welcome to Voyage Vista</h2>
    <div class="tabs">
      <button class="active" data-tab="loginTab">Login</button>
      <button data-tab="signupTab">Sign Up</button>
    </div>
    <div id="loginTab" class="modal-content active">
      <input type="email" placeholder="Email" />
      <input type="password" placeholder="Password" />
      <button>Login</button>
    </div>
    <div id="signupTab" class="modal-content">
      <form id="signup-form">
        <input name="username" placeholder="Username" required>
        <input name="email" type="email" placeholder="Email" required>
        <input name="password" type="password" placeholder="Password" required>
        <button type="submit">Create Account</button>
      </form>
    </div>
  </div>
</div>
    <div class="modal-backdrop" id="profileModal" style="display:none;">
  <div class="modal-window" style="min-width:320px;max-width:95vw;">
    <button class="modal-close" onclick="document.getElementById('profileModal').style.display='none'">&times;</button>
    <h2>Your Profile</h2>
    <div id="profileDetails"></div>
    <div id="profileActions" style="margin-top:1.5rem;display:flex;gap:1rem;justify-content:flex-end;"></div>
  </div>
</div>
    <nav id="navbar">
      <div class="logo">Voyage Vista</div>
      <div class="nav-links">
        <a href="#hero">Home</a>
        <a href="#services">Services</a>
        <a href="#destinations">Destinations</a>
        <a href="#benefits">Benefits</a>
        <a href="#classes">Classes</a>
        <a href="#about">About</a>
      </div>
      <div class="nav-icons">
        <a href="#" title="Language"><i class="fas fa-globe"></i></a>
        <a href="#" title="Search"><i class="fas fa-search"></i></a>
        <a href="#" title="Profile"><i class="fas fa-user-circle"></i></a>
      </div>
      <div class="menu-toggle"><i class="fas fa-bars"></i>
      </div>
    </nav>

    <main>
      <!-- Hero Section with passenger & class selector -->
      <section class="hero" id="hero">
        <div class="hero-bg"></div>
        <div class="panel">
          <div class="tabs">
            <button class="tab-btn active" data-target="search-form">
              <i class="fas fa-plane"></i> Search flights
            </button>
            <button class="tab-btn" data-target="manage-form">
              <i class="fas fa-tag"></i> Luggage
            </button>
            <button class="tab-btn" data-target="whatson-form">
              <i class="fas fa-pen-nib"></i> What's on your flight
            </button>
            <button class="tab-btn" data-target="status-form">
              <i class="fas fa-clock"></i> Flight status
            </button>
            <button class="tab-btn" data-target="my-bookings-form">
              <i class="fas fa-ticket-alt"></i> My Bookings
            </button>
          </div>
          <div class="tab-content active" id="search-form">
            <form id="flightSearchForm" class="form-grid">
              <div class="field">
                <i class="fas fa-map-marker-alt"></i>
                <input name="departure" placeholder="Departure airport" required/>
              </div>
              <div class="field">
                <i class="fas fa-map-marker-alt"></i>
                <input name="arrival" placeholder="Arrival airport" required/>
              </div>
              <div class="field">
                <i class="fas fa-calendar-alt"></i>
                <input name="date" type="date" required/>
              </div>
              <button class="search-btn" type="submit">Search Flights</button>
            </form>
            <div id="searchResults" class="results"></div>
          </div>
          <div class="tab-content" id="manage-form">
            <form class="form-grid">
              <div class="field">
                <i class="fas fa-user"></i
                ><input type="text" placeholder="KG" />
              </div>
              <div class="field">
                <i class="fas fa-ticket-alt"></i
                ><input type="text" placeholder="Booking reference" />
              </div>
              <button class="search-btn" type="submit">Manage booking</button>
              <button class="search-btn" type="submit">Check in</button>
            </form>
          </div>
          <div id="whatson-form" class="tab-content">
  <h3>What’s On Your Flight</h3>
  <form>
    <div class="field">
      <i class="fas fa-plane-departure"></i>
      <input name="departure" type="text" placeholder="From (e.g. Bengaluru)" required>
    </div>
    <div class="field">
      <i class="fas fa-plane-arrival"></i>
      <input name="arrival" type="text" placeholder="To (e.g. New Delhi)" required>
    </div>
    <div class="field">
      <i class="fas fa-calendar-alt"></i>
      <input name="date" type="date" required>
    </div>
    <button class="search-btn" type="submit">Find Services</button>
  </form>

  <div id="whatson-results" class="results"></div>
</div>

          <div class="tab-content" id="status-form">
            <form class="form-grid">
              <div class="field">
                <i class="fas fa-route"></i>
                <label>
                  <input type="radio" name="status-mode" checked /> Route
                </label>
                <label style="margin-left: 1rem">
                  <input type="radio" name="status-mode" /> Flight number
                </label>
              </div>
              <div class="field">
                <i class="fas fa-map-marker-alt"></i
                ><input type="text" placeholder="Departure airport" />
              </div>
              <div class="field">
                <i class="fas fa-map-marker-alt"></i
                ><input type="text" placeholder="Arrival airport" />
              </div>
              <div class="field">
                <i class="fas fa-calendar-alt"></i><input type="date" />
              </div>
              <button class="search-btn" type="submit">Check status</button>
            </form>
          </div>
          <div class="tab-content" id="my-bookings-form">
            <div id="myBookingsResults"></div>
          </div>
        </div>
      </section>

      <!-- Services -->
      <section id="services" class="services">
        <div class="panel services-grid">
          <a class="service" href="#"
            ><i class="fas fa-hotel"></i><span>Hotels</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-car"></i><span>Car rentals</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-umbrella-beach"></i
            ><span>Tours & activities</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-sun"></i><span>Book a holiday</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-user-tie"></i><span>Chauffeur-drive</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-handshake"></i><span>Meet & Greet</span></a
          >
          <a class="service" href="#"
            ><i class="fas fa-bus"></i><span>Airport transfers</span></a
          >
        </div>
      </section>

      <!-- Skywards Banner -->
<section class="banner-skywards">
  <div class="panel banner-panel">
    <div class="banner-content">
      <div class="levels">
        <img src="/Emirates-Premium-Economy-India.webp" alt="Skywards Levels" />
      </div>
      <div class="content-wrap" style="position: relative; z-index: 2;">
        <div class="text">
          <h3>Join Emirates Skywards</h3>
          <p>Become an Emirates Skywards member and start enjoying flight rewards, upgrades and more</p>
        </div>
        <button class="em-btn">Join now</button>
      </div>
    </div>
  </div>
</section>

      <!-- Destinations -->
      <section id="destinations" class="destinations">
        <div class="panel">
          <h2>Featured Destinations</h2>
          <div class="destinations-grid">
           <div class="dest-card">
  <img src="pexels-tirachard-kumtanom-112571-472309.jpg" alt="Destination 1" />
  <div class="dest-card-info">
    <h3>Thailand</h3>
    <span>From INR 20,000*</span>
  </div>
</div>
            <div class="dest-card">
              <img
                src="/dubai-marina-beauty-view-rooftop-showing-cityscape-boats-sea-view-51444879.webp"
                alt="Destination 2"
              />
              <div class="dest-card-info">
                <h3>Dubai</h3>
                <span>From INR 25,000*</span>
              </div>
            </div>
            <div class="dest-card">
  <img src="pexels-kin-pastor-251088-777059.jpg" alt="Destination 3" />
  <div class="dest-card-info">
    <h3>Singapore</h3>
    <span>From INR 30,000*</span>
  </div>
</div>
            <div class="dest-card">
              <img src="/112313239.webp" alt="Destination 4" />
              <div class="dest-card-info">
                <h3>London</h3>
                <span>From INR 40,000*</span>i
              </div>
            </div>
            <div class="dest-card">
              <img
                src="/eiffel-tower-paris-france-EIFFEL0217-6ccc3553e98946f18c893018d5b42bde.jpg"
                alt="Destination 5"
              />
              <div class="dest-card-info">
                <h3>Paris</h3>
                <span>From INR 55,000*</span>
              </div>
            </div>
       <div class="dest-card">
  <img src="nyc.jpg" alt="Destination 6" />
  <div class="dest-card-info">
    <h3>New York City</h3>
    <span>From INR 60,000*</span>
  </div>
</div>
          </div>
        </div>
      </section>

      <!-- Benefits -->
      <section id="benefits" class="benefits">
        <div class="panel">
          <h2>Enhance Your Benefits with Skywards+</h2>
          <p>
            Enjoy lounge access, extra baggage allowance, exclusive discounts,
            and more.
          </p>
        </div>
      </section>

      <!-- Classes -->
      <section id="classes" class="classes">
        <h2>Experience Luxury Travel</h2>
        <div class="class-grid">
          <div class="class-card">
            <img
              src="/636462447474375477-First-Class-fully-flat-bed.webp"
              alt="First Class"
            />
            <div class="class-card-info">
              <h3>First Class</h3>
              <p>
                Private suites with sliding doors, personal minibar, and
                24-karat gold accents.
              </p>
              <div class="class-features">
                <div><i class="fas fa-spa"></i> Onboard Spa</div>
                <div><i class="fas fa-utensils"></i> Gourmet Dining</div>
              </div>
            </div>
          </div>
          <div class="class-card">
            <img
              src="/Emirates-B777-Classe-Affaires-16-1024x768.jpg"
              alt="Business Class"
            />
            <div class="class-card-info">
              <h3>Business Class</h3>
              <p>
                Lie-flat seats, chef-curated menus, priority boarding, and
                personal lounge access.
              </p>
              <div class="class-features">
                <div><i class="fas fa-couch"></i> Lounge Access</div>
                <div><i class="fas fa-handshake"></i> Concierge Service</div>
              </div>
            </div>
          </div>
          <div class="class-card">
            <img src="/img_0820.avif" alt="Premium Economy" />
            <div class="class-card-info">
              <h3>Premium Economy</h3>
              <p>
                Extra legroom, enhanced meals, dedicated cabin crew, and amenity
                kits.
              </p>
              <div class="class-features">
                <div><i class="fas fa-chair"></i> Extra Legroom</div>
                <div><i class="fas fa-wine-glass"></i> Enhanced Meals</div>
              </div>
            </div>
          </div>
          <div class="class-card">
            <img src="/img_0859.avif" alt="Economy Class" />
            <div class="class-card-info">
              <h3>Economy Class</h3>
              <p>
                Comfortable seating, inflight entertainment, and complimentary
                refreshments.
              </p>
              <div class="class-features">
                <div><i class="fas fa-film"></i> Entertainment</div>
                <div><i class="fas fa-coffee"></i> Refreshments</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- About -->
      <section id="about" class="about">
        <div class="panel">
          <h2>About Us</h2>
          <p>
            At Voyage Vista, we believe in redefining travel with exceptional
            service and innovative experiences. From seamless bookings to
            personalized in-flight amenities, our commitment is to make every
            journey memorable.
          </p>
        </div>
      </section>

      <!-- Footer -->
      <section class="options">
        <div class="footer-grid">
          <div>
            <h4>About</h4>
            <a href="#">Our Story</a><a href="#">Sustainability</a
            ><a href="#">Careers</a>
          </div>
          <div>
            <h4>Explore</h4>
            <a href="#">Route Map</a><a href="#">Destinations</a
            ><a href="#">Cabin Classes</a>
          </div>
          <div>
            <h4>Support</h4>
            <a href="#">Help Center</a><a href="#">Flight Status</a
            ><a href="#">Contact Us</a>
          </div>
          <div>
            <h4>Connect</h4>
            <a href="#"><i class="fab fa-facebook-square"></i> Facebook</a
            ><a href="#"><i class="fab fa-instagram"></i> Instagram</a>
          </div>
        </div>
      </section>
      <div class="copyright">© 2025 Voyage Vista. All rights reserved.</div>
    </main>

    <button id="logoutBtn" style="display:none;">Logout</button>

   

    <script>
      // Mobile nav toggle
      document.querySelector(".menu-toggle").addEventListener("click", () => {
        document.querySelector(".nav-links").classList.toggle("active");
      });
      // Navbar scroll effect
      const navbar = document.getElementById("navbar");
      window.addEventListener("scroll", () => {
        navbar.classList.toggle("scrolled", window.scrollY > 50);
      });
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          // deactivate all
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((p) => p.classList.remove("active"));
          // activate clicked + its panel
          btn.classList.add("active");
          document.getElementById(btn.dataset.target).classList.add("active");
        });
      });
    </script>
    <!-- ...existing code... -->
    <button class="feedback-btn" aria-label="Feedback">
      <i class="fas fa-comment-dots"></i>
    </button>
    <!-- ...existing code... -->
    <script>
      // Feedback button functionality
      document.querySelector(".feedback-btn").addEventListener("click", () => {
        alert("Thank you for your feedback!");
      });
    </script>

    <!-- Cookie Consent Modal -->
    <div class="cookie-consent" id="cookieConsent">
        <div class="cookie-text">
            We use cookies to enhance your experience. By continuing to visit this site, you agree to our use of cookies. 
            <a href="/privacy-policy" target="_blank">Learn more</a>
        </div>
        <div class="cookie-buttons">
            <button class="cookie-btn cookie-accept" id="acceptCookies">Accept</button>
            <button class="cookie-btn cookie-decline" id="declineCookies">Decline</button>
        </div>
    </div>
    <script>
        // Cookie consent functionality
        const cookieConsent = document.getElementById('cookieConsent');
        const acceptCookies = document.getElementById('acceptCookies');
        const declineCookies = document.getElementById('declineCookies');

        if(cookieConsent && acceptCookies && declineCookies && !localStorage.getItem('cookiesAccepted')) {
            setTimeout(() => {
                cookieConsent.classList.add('active');
            }, 1000);
        }
        if(acceptCookies) acceptCookies.addEventListener('click', () => {
            localStorage.setItem('cookiesAccepted', 'true');
            cookieConsent.classList.remove('active');
        });
        if(declineCookies) declineCookies.addEventListener('click', () => {
            localStorage.setItem('cookiesDeclined', 'true');
            cookieConsent.classList.remove('active');
        });
    </script>
    
    <script>
  // Tabs inside modal
  document.querySelectorAll('.modal-window .tabs button').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      document.querySelectorAll('.modal-window .tabs button').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.modal-content').forEach(c=>c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });
  // Close modal
  document.querySelector('.modal-close').addEventListener('click', ()=>{
    document.getElementById('authModal').style.display = 'none';
  });
  // Prevent interacting with page until closed
  window.addEventListener('load', ()=>{
    if (!localStorage.getItem('userEmail')) {
    document.getElementById('authModal').style.display = 'flex';
  } else {
    document.getElementById('authModal').style.display = 'none';
  }
  });

// document.querySelector('#whatson-form form').addEventListener('submit', function(e) {
//   e.preventDefault();
//   const fields = this.querySelectorAll('input');
//   const data = {
//     departure: fields[0].value,
//     arrival: fields[1].value,
//     date: fields[2].value
//   };
//   fetch('http://localhost:3000/api/whatson', {
//     method: 'POST',
//     headers: { 'Content-Type': 'application/json' },
//     body: JSON.stringify(data)
//   })
//   .then(res => res.json())
//   .then(services => {
//     let html = '<h3>What\'s on your flight:</h3>';
//     if (services.length === 0) {
//       html += '<p>No inflight services found for this flight.</p>';
//     } else {
//       services.forEach(s => {
//         html += `<div>
//           <strong>${s.service_name}</strong>: ${s.description}
//         </div>`;
//       });
//     }
//     document.querySelector('#whatson-form').innerHTML = html;
//   })
//   .catch(err => {
//     document.querySelector('#whatson-form').innerHTML = `<p>Error: ${err.message}</p>`;
//   });
// });

// Signup
document.querySelector('#signup-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const username = this.username.value;
  const email = this.email.value;
  const password = this.password.value;

  fetch('http://localhost:3000/api/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, email, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      alert('Signup failed: ' + data.error);
    } else {
      alert('Signup successful!');
      localStorage.setItem('userEmail', email); // Save email
      localStorage.setItem('username', username); 
      document.getElementById('authModal').style.display = 'none';
    }
  })
  .catch(() => alert('Signup failed: Server error'));
});

// Login
document.querySelector('#loginTab button').addEventListener('click', function(e) {
  e.preventDefault();
  const email = document.querySelector('#loginTab input[type="email"]').value;
  const password = document.querySelector('#loginTab input[type="password"]').value;

  fetch('http://localhost:3000/api/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      alert('Login failed: ' + data.error);
    } else {
      alert('Login successful!');
      localStorage.setItem('userEmail', email); // Save email
      document.getElementById('authModal').style.display = 'none';
    }
  })
  .catch(() => alert('Login failed: Server error'));
});

document
  .getElementById('flightSearchForm')
  .addEventListener('submit', async function(e) {
    e.preventDefault();

    // Collect named fields
    const form = e.target;
    const departure = form.departure.value.trim();
    const arrival   = form.arrival.value.trim();
    const dateInput = new Date(form.date.value);
    const date = dateInput.toISOString().split('T')[0];

    const resultsContainer = document.getElementById('searchResults');
    resultsContainer.innerHTML = '<p>Searching…</p>';

    try {
      const res = await fetch(
  `http://localhost:3000/api/search-flights?departure=${encodeURIComponent(departure)}&arrival=${encodeURIComponent(arrival)}&date=${date}`
);
      if (!res.ok) throw new Error(`Server error ${res.status}`);
      const data = await res.json(); // array of route objects

      // Render
      if (!Array.isArray(data)) {
        throw new Error('Invalid response format');
      }
      if (data.length === 0) {
        resultsContainer.innerHTML = '<p>No flights found.</p>';
      } else {
        let html = '<div class="flights-container">';
        data.forEach(f => {
          html += `
  <div class="flight-card">
    <div class="flight-details-pane">
      <div class="flight-info">
        <div>
          <strong>${f.flight_number}</strong> — ${f.departure} → ${f.arrival}
        </div>
        <div>
          <small>${new Date(f.date).toLocaleDateString()} • ${f.status}</small>
        </div>
      </div>
      <button class="book-btn" data-id="${f.id}">Book</button>
    </div>
    <div class="booking-form-pane" id="booking-form-${f.id}" style="display:none;">
      <form>
        <label>
        Class:
        <select  id="classSelect" name="class_type" class="class-select" required>
          <option value="">Select Class</option>
          ${Object.entries(f.classes)
            .filter(([type]) => ['first','business','premium','economy'].includes(type))
            .map(([type, info]) => {
              const labelMap = {
                first: 'First Class',
                business: 'Business Class',
                premium: 'Premium Class',
                economy: 'Economy Class'
              };
              return `
            <option value="${type}" data-price="${info.adult_price}">
              ${labelMap[type]} — $${info.adult_price}
            </option>`;
            }).join('')}
        </select>
      </label>
      <div class="price-display" style="margin:0.5rem 0; font-weight:bold;"></div>
        <label>
          First Name: <input type="text" name="firstName" required>
        </label>
        <label>
          Last Name: <input type="text" name="lastName" required>
        </label>
        <label>
          Email: <input type="email" name="email" required>
        </label>
        <label>
          Phone Number: <input type="tel" name="phone" required pattern="[0-9]{10}">
        </label>
        <label>
          Country:
          <select name="country" required>
            <option value="">Select Country</option>
            <option>India</option>
            <option>United States</option>
            <option>Canada</option>
            <option>Germany</option>
            <option>Australia</option>
            <option>Other</option>
          </select>
        </label>
        <button type="submit">Confirm Booking</button>
      </form>
    </div>
  </div>
`;


        });
        html += '</div>';
        resultsContainer.innerHTML = html;

        // Book button logic
       document.querySelectorAll('.book-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    // hide other forms & collapse others
    document.querySelectorAll('.booking-form-pane').forEach(p => p.style.display = 'none');
    document.querySelectorAll('.flight-card').forEach(card => card.classList.remove('expanded'));

    // show this one & expand its card
    const pane = document.getElementById('booking-form-' + btn.dataset.id);
    pane.style.display = 'flex';
    btn.closest('.flight-card').classList.add('expanded');
  });
});


        document.querySelectorAll('.booking-form-pane form').forEach(form => {
  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const firstName = this.firstName.value.trim();
    const lastName = this.lastName.value.trim();
    const email = this.email.value.trim();
    const phone = this.phone.value.trim();
    const country = this.country.value;

    const flightId = this.closest('.booking-form-pane').id.replace('booking-form-', '');

    fetch('http://localhost:3000/api/bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        flight_id: flightId,
        class_type: document.getElementById('classSelect').value,
        first_name: firstName,
        last_name: lastName,
        email,
        phone,
        country
      })
    })
    .then(res => res.json())
    .then(data => {
      alert(data.message || 'Booking successful!');
      this.closest('.booking-form-pane').style.display = 'none';
    })
    .catch(() => alert('Booking failed!'));
  });
});

      }
    } catch (err) {
      console.error(err);
      resultsContainer.innerHTML = `<p class="error">Error: ${err.message}</p>`;
    }
  });

// When "My Bookings" tab is clicked
// When "My Bookings" tab is clicked
document.addEventListener('DOMContentLoaded', () => {
  const myBookingsTab = document.querySelector('[data-target="my-bookings-form"]');
  const bookingsContainer = document.getElementById('myBookingsResults');

  myBookingsTab.addEventListener('click', () => {
    const userEmail = localStorage.getItem('userEmail');

    bookingsContainer.innerHTML = ''; // ✅ clear previous output

    if (!userEmail) {
      bookingsContainer.innerHTML = '<p>Please log in to view your bookings.</p>';
      return;
    }

    fetch(`http://localhost:3000/api/my-bookings?user_email=${encodeURIComponent(userEmail)}`)
      .then(res => res.json())
      .then(data => {
        if (!Array.isArray(data) || data.length === 0) {
          bookingsContainer.innerHTML = '<p>No bookings found.</p>';
          return;
        }

        let html = '<h3>Your Bookings</h3><ul>';
        data.forEach(booking => {
          html += `
            <li data-booking-id="${booking.booking_id}">
              <strong>${booking.flight_number}</strong> — ${booking.departure} → ${booking.arrival} (${new Date(booking.date).toLocaleString()})
              <br>Class: ${booking.class_type}
              <br>Status: ${booking.status || 'Confirmed'}
              <br>Booked at: ${new Date(booking.booking_date).toLocaleString()}
              <br><u>Passenger Details:</u>
              <br>Name: ${booking.title} ${booking.first_name} ${booking.last_name}
              <br>Email: ${booking.passenger_email}
              <br>Phone: ${booking.phone}
              <br>Country: ${booking.country}
              <br><button class="cancel-booking-btn" data-id="${booking.booking_id}">Cancel Booking</button>
            </li>`;
        });
        html += '</ul>';
        bookingsContainer.innerHTML = html;

        // ✅ Only bind event listeners once, after rendering the cancel buttons
        document.querySelectorAll('.cancel-booking-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const bookingId = btn.dataset.id;
            if (confirm('Are you sure you want to cancel this booking?')) {
              fetch(`http://localhost:3000/api/cancel-booking/${bookingId}`, {
                method: 'DELETE'
              })
                .then(res => res.json())
                .then(result => {
                  alert(result.message || 'Booking cancelled.');
                  btn.closest('li').remove();
                })
                .catch(() => alert('Failed to cancel booking.'));
            }
          });
        });
      })
      .catch(() => {
        bookingsContainer.innerHTML = '<p>Error retrieving bookings. Please try again later.</p>';
      });
  });
});


const logoutBtn = document.getElementById('logoutBtn');
if (logoutBtn) {
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('userEmail');
    location.reload();
  });
}

// Show logout button if logged in
if (localStorage.getItem('userEmail')) {
  if (logoutBtn) logoutBtn.style.display = 'inline-block';
}
document.querySelector('.fa-user-circle').addEventListener('click', function(e) {
  e.preventDefault();
  const username = localStorage.getItem('username');
  const email = localStorage.getItem('userEmail');
  const profileDetails = document.getElementById('profileDetails');
  const profileActions = document.getElementById('profileActions');
  profileActions.innerHTML = '';

  if (email) {
    // User is logged in
    profileDetails.innerHTML = `
      <p><strong>Username:</strong> ${username || 'N/A'}</p>
      <p><strong>Email:</strong> ${email}</p>
    `;
    // Logout button
    const logoutBtn = document.createElement('button');
    logoutBtn.textContent = 'Logout';
    logoutBtn.className = 'search-btn primary';
    logoutBtn.onclick = function() {
      localStorage.removeItem('userEmail');
      localStorage.removeItem('username');
      document.getElementById('profileModal').style.display = 'none';
      location.reload();
    };
    profileActions.appendChild(logoutBtn);
  } else {
    // User is not logged in
    profileDetails.innerHTML = `<p>You are not logged in.</p>`;
    // Login and Signup buttons
    const loginBtn = document.createElement('button');
    loginBtn.textContent = 'Login';
    loginBtn.className = 'search-btn primary';
    loginBtn.onclick = function() {
      document.getElementById('profileModal').style.display = 'none';
      document.getElementById('authModal').style.display = 'flex';
      // Switch to login tab
      document.querySelector('.modal-window .tabs button[data-tab="loginTab"]').click();
    };
    const signupBtn = document.createElement('button');
    signupBtn.textContent = 'Sign Up';
    signupBtn.className = 'search-btn';
    signupBtn.onclick = function() {
      document.getElementById('profileModal').style.display = 'none';
      document.getElementById('authModal').style.display = 'flex';
      // Switch to signup tab
      document.querySelector('.modal-window .tabs button[data-tab="signupTab"]').click();
    };
    profileActions.appendChild(loginBtn);
    profileActions.appendChild(signupBtn);
  }

  document.getElementById('profileModal').style.display = 'flex';
});
document
  .querySelector('#whatson-form form')
  .addEventListener('submit', async function(e) {
    e.preventDefault();

    const dep  = this.departure.value.trim();
    const arr  = this.arrival.value.trim();
    const date = this.date.value; // yyyy‑mm‑dd

    const resultsEl = document.getElementById('whatson-results');
    resultsEl.innerHTML = '<p>Loading services…</p>';

    try {
      // GET with query params
      const url = new URL('http://localhost:3000/api/whatson');
      url.searchParams.set('departure', dep);
      url.searchParams.set('arrival', arr);
      url.searchParams.set('date', date);

      const res = await fetch(url);
      if (!res.ok) throw new Error(`Server error ${res.status}`);

      const services = await res.json();
      if (!Array.isArray(services) || services.length === 0) {
        resultsEl.innerHTML = '<p>No in‑flight services found for this route.</p>';
        return;
      }

      // Render list
      let html = '<ul class="service-list">';
      services.forEach(s => {
        html += `
          <li class="service-card">
            <h4>${s.service_name}</h4>
            <p>${s.description}</p>
          </li>`;
      });
      html += '</ul>';
      resultsEl.innerHTML = html;

    } catch (err) {
      console.error(err);
      resultsEl.innerHTML = `<p class="error">Error: ${err.message}</p>`;
    }
  });


</script>
<style>
.cancel-booking-btn {
  background: #ff4d4f;
  color: #fff;
  border: none;
  border-radius: 7px;
  padding: 0.5rem 1.2rem;
  font-size: 1rem;
  font-weight: 600;
  margin-top: 0.7rem;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
  box-shadow: 0 2px 8px rgba(255,77,79,0.08);
  outline: none;
}
.cancel-booking-btn:hover,
.cancel-booking-btn:focus {
  background: #d9363e;
  color: #fff;
  box-shadow: 0 4px 16px rgba(255,77,79,0.13);
}

.booking-modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.8);
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 600px;
  border-radius: 8px;
  position: relative;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.flight-summary {
  margin-bottom: 20px;
}

.passenger-details,
.contact-details {
  margin-bottom: 20px;
}

.form-row {
  display: flex;
  justify-content: space-between;
  gap: 10px;
}

.form-group {
  flex: 1;
}

.submit-btn {
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.submit-btn:hover {
  background-color: #0056b3;
}

/* New styles for flight cards */
.flights-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.flight-card {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
}

.flight-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.flight-header {
  background: #007bff;
  color: #fff;
  padding: 1rem;
  text-align: center;
}

.flight-details {
  padding: 1rem;
}

.route {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
}

.route i {
  color: #007bff;
}

.class-options {
  margin-top: 1rem;
}

.class-option {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  transition: background 0.3s;
}

.class-option:hover {
  background: #e2e6ea;
}

.sold-out {
  color: #dc3545;
  font-weight: bold;
  margin-top: 0.5rem;
}

.no-results {
  text-align: center;
  font-size: 1.2rem;
  color: #6c757d;
}

.error {
  color: #dc3545;
  text-align: center;
  margin-top: 1rem;
}
</style>
<script>
// Update the flight search function
function searchFlights() {
    const departure = document.getElementById('departure').value;
    const arrival = document.getElementById('arrival').value;
    const date = document.getElementById('date').value;

    fetch(`http://localhost:3000/api/search-flights?departure=${departure}&arrival=${arrival}&date=${date}`)
        .then(res => res.json())
        .then(flights => {
            let html = '';
            flights.forEach(flight => {
                html += `
                    <div class="flight-card">
                        <div class="flight-details-pane">
                            <div class="flight-info">
                                <strong>${flight.airline}</strong>
                                <p>${flight.flight_number}</p>
                                <p>${flight.departure} → ${flight.arrival}</p>
                                <p>Date: ${new Date(flight.date).toLocaleDateString()}</p>
                                <p>Status: ${flight.status}</p>
                            </div>
                        </div>
                        <div class="class-options">
                            ${Object.entries(flight.classes).map(([type, details]) => `
                                <div class="class-option">
                                    <h4>${type.charAt(0).toUpperCase() + type.slice(1)} Class</h4>
                                    <p>Available Seats: ${details.available_seats}</p>
                                    <p>Adult: $${details.adult_price}</p>
                                    <p>Child: $${details.child_price}</p>
                                    ${details.available_seats > 0 ? 
                                        `<button class="book-btn" onclick="showBookingForm('${flight.id}', '${type}')">
                                            Book ${type.charAt(0).toUpperCase() + type.slice(1)}
                                        </button>` : 
                                        '<p class="sold-out">Sold Out</p>'
                                    }
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            document.getElementById('searchResults').innerHTML = html || '<p>No flights found</p>';
        })
        .catch(err => {
            console.error('Error:', err);
            document.getElementById('searchResults').innerHTML = '<p>Error fetching flights</p>';
        });
}

// Update the booking form submission
function handleBooking(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const bookingData = {
        flight_id: formData.get('flight_id'),
        class_type: formData.get('class_type'),
        user_email: localStorage.getItem('userEmail'),
        adults: parseInt(formData.get('adults')),
        children: parseInt(formData.get('children'))
    };

    fetch('http://localhost:3000/api/book-flight', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(bookingData)
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
        } else {
            alert('Booking successful!');
            closeBookingForm();
            loadMyBookings();
        }
    })
    .catch(err => {
        console.error('Error:', err);
        alert('Failed to book flight');
    });
}

function showBookingForm(flightId, classType, flightDetails) {
    const modal = document.getElementById('bookingModal');
    const summary = document.getElementById('flightSummary');
    
    // Set hidden inputs
    document.getElementById('flight_id').value = flightId;
    document.getElementById('class_type').value = classType;
    
    // Show flight summary
    summary.innerHTML = `
        <p><strong>Airline:</strong> ${flightDetails.airline}</p>
        <p><strong>Flight:</strong> ${flightDetails.flight_number}</p>
        <p><strong>From:</strong> ${flightDetails.departure}</p>
        <p><strong>To:</strong> ${flightDetails.arrival}</p>
        <p><strong>Date:</strong> ${new Date(flightDetails.date).toLocaleDateString()}</p>
        <p><strong>Class:</strong> ${classType}</p>
        <p><strong>Price:</strong> $${flightDetails.classes[classType].adult_price}</p>
    `;
    
    modal.style.display = 'block';
}

document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const bookingData = {
        flight_id: formData.get('flight_id'),
        class_type: formData.get('class_type'),
        passenger: {
            title: formData.get('title'),
            first_name: formData.get('first_name'),
            last_name: formData.get('last_name'),
            email: formData.get('email'),
            phone: formData.get('phone'),
            country: formData.get('country')
        }
    };

    try {
        const response = await fetch('http://localhost:3000/api/bookings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(bookingData)
        });

        const data = await response.json();
        
        if (response.ok) {
            alert('Booking successful!');
            document.getElementById('bookingModal').style.display = 'none';
        } else {
            throw new Error(data.error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Booking failed: ' + error.message);
    }
});

// Update the search function
async function searchFlights() {
    const departure = document.getElementById('departure').value;
    const arrival = document.getElementById('arrival').value;
    const date = document.getElementById('date').value;

    try {
        const response = await fetch(`http://localhost:3000/api/search-flights?departure=${encodeURIComponent(departure)}&arrival=${encodeURIComponent(arrival)}&date=${encodeURIComponent(date)}`);
        
        if (!response.ok) {
            throw new Error('Search failed');
        }

        const flights = await response.json();
        const resultsContainer = document.getElementById('searchResults');

        if (flights.length === 0) {
            resultsContainer.innerHTML = '<p class="no-results">No flights found for the selected criteria.</p>';
            return;
        }

        let html = '';
        flights.forEach(flight => {
            html += `
                <div class="flight-card">
                    <div class="flight-header">
                        <h3>${flight.airline}</h3>
                        <p>Flight: ${flight.flight_number}</p>
                    </div>
                    <div class="flight-details">
                        <div class="route">
                            <span>${flight.departure}</span>
                            <i class="fas fa-plane"></i>
                            <span>${flight.arrival}</span>
                        </div>
                        <div class="date-time">
                            <p>Date: ${new Date(flight.date).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="class-options">
                        ${Object.entries(flight.classes).map(([type, details]) => `
                            <div class="class-option ${type}">
                                <h4>${type.charAt(0).toUpperCase() + type.slice(1)} Class</h4>
                                <p>Available Seats: ${details.available_seats}</p>
                                <p>Adult: $${details.adult_price}</p>
                                <p>Child: $${details.child_price}</p>
                                ${details.available_seats > 0 ? 
                                    `<button onclick="showBookingForm('${flight.id}', '${type}', ${JSON.stringify(flight).replace(/"/g, '&quot;')})" class="book-btn">
                                        Book Now
                                    </button>` : 
                                    '<p class="sold-out">Sold Out</p>'
                                }
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });

        resultsContainer.innerHTML = html;
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('searchResults').innerHTML = 
            '<p class="error">Error searching flights. Please try again.</p>';
    }
}

// Add event listener to search form
document.getElementById('searchForm').addEventListener('submit', function(e) {
    e.preventDefault();
    searchFlights();
});
</script>
</body>
</html>
